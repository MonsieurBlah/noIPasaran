var fs = require('fs');
var path = require('path');
var vm = require('vm');

var Packet = require('./packet');

var fixtureDir = path.join(__dirname, 'test', 'fixtures');

var files = fs.readdirSync(fixtureDir).filter(function (f) { return /\.js$/.test(f); });

var packets = files.map(function (file) {
  var js = 'foo=' + fs.readFileSync(path.join(fixtureDir, file));
  return vm.runInThisContext(js, file);
});

var T = 100000;

var buff = new Buffer(4096);
for (var i = 0; i < T; i++)
  var p = Packet.write(buff, packets[i % packets.length]);
