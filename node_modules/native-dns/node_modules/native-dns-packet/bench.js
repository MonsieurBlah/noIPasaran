var fs = require('fs');
var path = require('path');

var Packet = require('./packet');
var OldPacket = require('./packet_old');

var fixtureDir = path.join(__dirname, 'test', 'fixtures');

var files = fs.readdirSync(fixtureDir).filter(function (f) { return /\.bin$/.test(f); });

var packets = files.map(function (file) { return fs.readFileSync(path.join(fixtureDir, file)) });


var T = 1000;

exports.compare = {
  'old': function () {
    for (var i = 0; i < packets.length; i++)
      var p = OldPacket.parse(packets[i]);
  },
  'new': function () {
    for (var i = 0; i < packets.length; i++)
      var p = Packet.parse(packets[i]);
  },
};
exports.compareCount = 16;
require('bench').runMain();
